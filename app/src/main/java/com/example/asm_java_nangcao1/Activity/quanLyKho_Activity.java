package com.example.asm_java_nangcao1.Activity;import androidx.annotation.NonNull;import androidx.appcompat.app.AppCompatActivity;import androidx.recyclerview.widget.DefaultItemAnimator;import androidx.recyclerview.widget.GridLayoutManager;import androidx.recyclerview.widget.RecyclerView;import android.app.Dialog;import android.content.Intent;import android.graphics.Color;import android.graphics.drawable.ColorDrawable;import android.os.Bundle;import android.os.Handler;import android.view.Gravity;import android.view.KeyEvent;import android.view.View;import android.view.Window;import android.view.WindowManager;import android.view.animation.Animation;import android.view.animation.AnimationUtils;import android.widget.EditText;import android.widget.ImageView;import android.widget.LinearLayout;import android.widget.ListView;import android.widget.TextView;import android.widget.Toast;import com.airbnb.lottie.LottieAnimationView;import com.example.asm_java_nangcao1.Adapter.vertical_listGioHang_Adapter;import com.example.asm_java_nangcao1.Adapter.vertical_listProduc_Adapter;import com.example.asm_java_nangcao1.Adapter.vertical_listQuanLyKhoHang_Adapter;import com.example.asm_java_nangcao1.Model.gioHang_Model;import com.example.asm_java_nangcao1.Model.khoHang_Model;import com.example.asm_java_nangcao1.R;import com.google.android.material.floatingactionbutton.FloatingActionButton;import com.google.firebase.database.DataSnapshot;import com.google.firebase.database.DatabaseError;import com.google.firebase.database.DatabaseReference;import com.google.firebase.database.FirebaseDatabase;import com.google.firebase.database.ValueEventListener;import java.util.ArrayList;public class quanLyKho_Activity extends AppCompatActivity {    private TextView SanPham_tv_textAnim;    private EditText            QuanLyKho_edt_search;    private ImageView            QuanLyKho_img_btn_back,            QuanLyKho_img_btn_search,            QuanLyKho_img_showifNullProduc;    private LinearLayout GioHang_costLout_loanding;    private RecyclerView            QuanLyKho_rscv_showSanPham;    private FloatingActionButton            QuanLyKho_floatAsBtn_themSanPham;    private LottieAnimationView            SanPham_loadingAnim_lotte;    Animation            SanPham_anim_txtContext;    //Model    ArrayList<khoHang_Model> khoHang_models;    khoHang_Model arrProduc;    FirebaseDatabase database;    DatabaseReference databaseRef;    vertical_listQuanLyKhoHang_Adapter adapter_vetical_quanLyKhoHang;    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        setContentView(R.layout.activity_quan_ly_kho);        anhXa();        anim();        batSuKien();        firebaseData();    }    public void setXoaItem_gioHang(String idSanPham, int viTri) {        final Dialog dialog = new Dialog(this);        dialog.requestWindowFeature(Window.FEATURE_NO_TITLE);        dialog.setContentView(R.layout.dialog_cuttom_xoasanpham);        Window window = dialog.getWindow();        if (window == null) {            return;        }        window.setLayout(WindowManager.LayoutParams.MATCH_PARENT, WindowManager.LayoutParams.WRAP_CONTENT);        window.setBackgroundDrawable(new ColorDrawable(Color.TRANSPARENT));        WindowManager.LayoutParams windowAttributes = window.getAttributes();        windowAttributes.gravity = Gravity.CENTER;        window.setAttributes(windowAttributes);//        sử lý khi nhấn ra ngoài thì có thoát hay không        dialog.setCancelable(false);//        khai báo bắt sự kiện        TextView Dialog_them_tvBtn_khong = dialog.findViewById(R.id.dialog_them_tvBtn_khong);        TextView Dialog_them_tvBtn_dongY = dialog.findViewById(R.id.dialog_them_tvBtn_dongY);//        tắt dialog đi        Dialog_them_tvBtn_khong.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                dialog.dismiss();            }        });        Dialog_them_tvBtn_dongY.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                dialog.dismiss();                databaseRef = database.getReference().child("khoHang");                databaseRef.child(idSanPham).removeValue();                adapter_vetical_quanLyKhoHang.notifyItemChanged(viTri);            }        });        dialog.show();    }    private void timKiem() {        String giaTriTimKiem = QuanLyKho_edt_search.getText().toString();        ArrayList<khoHang_Model> arrListTimKiem = new ArrayList<>();        if (!giaTriTimKiem.equals("")) {            for (int i = 0; i < khoHang_models.size(); i = i + 1) {                if ((khoHang_models.get(i).getTenSanPham()).toUpperCase().contains(giaTriTimKiem.toUpperCase())) {                    arrListTimKiem.add(new khoHang_Model(khoHang_models.get(i).getIdSanPham(), khoHang_models.get(i).getTenSanPham(), khoHang_models.get(i).getGiaSanPham(), khoHang_models.get(i).getLoaiSanPham(), khoHang_models.get(i).getXuatXu(), khoHang_models.get(i).getNgayNhap(), khoHang_models.get(i).getHinhAnh()));                } else {                }            }            QuanLyKho_rscv_showSanPham.setLayoutManager(new GridLayoutManager(this, 1));            QuanLyKho_rscv_showSanPham.setItemAnimator(new DefaultItemAnimator());//        Initilize            adapter_vetical_quanLyKhoHang = new vertical_listQuanLyKhoHang_Adapter(arrListTimKiem, quanLyKho_Activity.this);            QuanLyKho_rscv_showSanPham.setAdapter(adapter_vetical_quanLyKhoHang);        } else {            showListGioHang_Vartical(khoHang_models);        }    }    /********************Anim Loanding**********************/    private void anim() {        anhXa();        SanPham_tv_textAnim.setAnimation(SanPham_anim_txtContext);        SanPham_anim_txtContext.setAnimationListener(new Animation.AnimationListener() {            @Override            public void onAnimationStart(Animation animation) {            }            @Override            public void onAnimationEnd(Animation animation) {                SanPham_loadingAnim_lotte.setVisibility(View.VISIBLE);                final Handler handler = new Handler();                handler.postDelayed(new Runnable() {                    @Override                    public void run() {                        GioHang_costLout_loanding.setVisibility(View.INVISIBLE);                    }                }, 1000);            }            @Override            public void onAnimationRepeat(Animation animation) {            }        });    }    public void setShowItem_gioHang(String idSanPham, String anhSanPham, String tenSanPham, String giaSanPham, String xuatXu, String ngayNhap, int loaiSanPham) {        Intent intent = new Intent(quanLyKho_Activity.this, suaSanPham_themSanPham_adm_Activity.class);        Bundle bundle = new Bundle();        bundle.putString("key_idSanPham", idSanPham);        bundle.putString("key_imgSanPham", anhSanPham);        bundle.putString("key_tenSanPham", tenSanPham);        bundle.putString("key_giaSanPham", giaSanPham);        bundle.putString("key_xuatXuSanPham", xuatXu);        bundle.putString("key_ngayNhapSanPham", ngayNhap);        bundle.putInt("key_loaiSanPham", loaiSanPham);        intent.putExtras(bundle);        startActivity(intent);    }    private void batSuKien() {        //    bắt sự kiện chuyển trang thêm sản phẩm        QuanLyKho_floatAsBtn_themSanPham.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                Intent intent = new Intent(quanLyKho_Activity.this, suaSanPham_themSanPham_adm_Activity.class);                startActivity(intent);            }        });//  bát sự kiện thoát form        QuanLyKho_img_btn_back.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                Intent intent = new Intent(quanLyKho_Activity.this, thongTinUser_Activity.class);                startActivity(intent);            }        });QuanLyKho_img_btn_search.setOnClickListener(new View.OnClickListener() {    @Override    public void onClick(View view) {        timKiem();    }});        QuanLyKho_edt_search.setOnKeyListener(new View.OnKeyListener() {            @Override            public boolean onKey(View view, int i, KeyEvent keyEvent) {                String giaTriTimKiem = QuanLyKho_edt_search.getText().toString();                if (!giaTriTimKiem.equals("")) {                    showListGioHang_Vartical(khoHang_models);                }                return false;            }        });    }    /********************Show thông tin ra kiểu dọc**********************/    private void showListGioHang_Vartical(ArrayList<khoHang_Model> khoHangModels) {        QuanLyKho_rscv_showSanPham.setLayoutManager(new GridLayoutManager(this, 1));        QuanLyKho_rscv_showSanPham.setItemAnimator(new DefaultItemAnimator());//        Initilize        adapter_vetical_quanLyKhoHang = new vertical_listQuanLyKhoHang_Adapter(khoHangModels, quanLyKho_Activity.this);        QuanLyKho_rscv_showSanPham.setAdapter(adapter_vetical_quanLyKhoHang);    }    /********************lấy dữ liệu từ firebase gán vào arrList**********************/    private void firebaseData() {        khoHang_models = new ArrayList<>();        //         Gán giá trị trong firebase        databaseRef = database.getReference().child("khoHang");        databaseRef.addValueEventListener(new ValueEventListener() {            @Override            public void onDataChange(@NonNull DataSnapshot snapshot) {                khoHang_models.clear();                for (DataSnapshot child : snapshot.getChildren()) {                    // gọi dữ liệu trên firebase về                    arrProduc = child.getValue(khoHang_Model.class);                    // add vào listItemSanpham                    if (arrProduc.getIdSanPham() != null) {                        khoHang_models.add(new khoHang_Model(arrProduc.getIdSanPham(), arrProduc.getTenSanPham(), arrProduc.getGiaSanPham(), arrProduc.getLoaiSanPham(), arrProduc.getXuatXu(), arrProduc.getNgayNhap(), arrProduc.getHinhAnh()));                    }                }                //    gán vào adapter                showListGioHang_Vartical(khoHang_models);                adapter_vetical_quanLyKhoHang.notifyDataSetChanged();            }            @Override            public void onCancelled(DatabaseError error) {            }        });    }    private void anhXa() {        //        lotte        SanPham_loadingAnim_lotte = findViewById(R.id.sanPham_anim_Loanding);        SanPham_tv_textAnim = findViewById(R.id.sanPham_tv_textAnim);        //        anim        SanPham_anim_txtContext = AnimationUtils.loadAnimation(this, R.anim.header_anim);        GioHang_costLout_loanding = findViewById(R.id.gioHang_costLout_loanding);        database = FirebaseDatabase.getInstance("https://asmandroid-duan1-default-rtdb.asia-southeast1.firebasedatabase.app/");//        EditText        QuanLyKho_edt_search = findViewById(R.id.quanLyKho_edt_search);        QuanLyKho_img_btn_back = findViewById(R.id.quanLyKho_img_btn_back);//        ImageView        QuanLyKho_img_btn_search = findViewById(R.id.quanLyKho_img_btn_search);        QuanLyKho_img_showifNullProduc = findViewById(R.id.quanLyKho_img_showifNullProduc);//      RecyclerView        QuanLyKho_rscv_showSanPham = findViewById(R.id.quanLyKho_rscv_showSanPham);//        FloatingActionButton        QuanLyKho_floatAsBtn_themSanPham = findViewById(R.id.quanLyKho_floatAsBtn_themSanPham);    }}