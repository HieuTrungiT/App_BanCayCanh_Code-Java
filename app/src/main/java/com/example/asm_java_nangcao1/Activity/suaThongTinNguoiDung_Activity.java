package com.example.asm_java_nangcao1.Activity;import androidx.annotation.NonNull;import androidx.appcompat.app.AppCompatActivity;import android.content.Intent;import android.content.SharedPreferences;import android.os.Bundle;import android.view.View;import android.widget.EditText;import android.widget.ImageView;import android.widget.LinearLayout;import android.widget.Toast;import com.example.asm_java_nangcao1.Model.accout_user_Model;import com.example.asm_java_nangcao1.R;import com.example.asm_java_nangcao1.quanLyThanhVien_Activity;import com.google.firebase.database.DataSnapshot;import com.google.firebase.database.DatabaseError;import com.google.firebase.database.DatabaseReference;import com.google.firebase.database.FirebaseDatabase;import com.google.firebase.database.ValueEventListener;import java.util.ArrayList;public class suaThongTinNguoiDung_Activity extends AppCompatActivity {    private ImageView            SuaThongTinNguoiDung_img_btn_back;    private EditText            SuaThongTinNguoiDung_edt_tenNguoiDung,            SuaThongTinNguoiDung_edt_tenDangNhap,            SuaThongTinNguoiDung_edt_gmail,            SuaThongTinNguoiDung_edt_soDienThoaiNguoiDung,            SuaThongTinNguoiDung_edt_diaChi,            SuaThongTinNguoiDung_edt_matKhau,            SuaThongTinNguoiDung_edt_xacNhanMatKhau;    String reg = "^(0|\\+84)(\\s|\\.)?((3[2-9])|(5[689])|(7[06-9])|(8[1-689])|(9[0-46-9]))(\\d)(\\s|\\.)?(\\d{3})(\\s|\\.)?(\\d{3})$";    private LinearLayout            SuaThongTinNguoiDung_llout_suaThongTin, ThongTinUser_llout_quanLyNhanVien;    String idUser, idgioHangShr, avatarShr, nameShr, userNameShr, passwordShr, diaChiShr, gmailShr, matKhauShr;    int quyenShr, soDienThoaiShr;    private SharedPreferences shareAcout;    String name, userName, gmail, address, numberPhone, password, repeatPassword;    //firebase    FirebaseDatabase database;    DatabaseReference databaseRef;    //model    ArrayList<accout_user_Model> arrayListAcoutUsser;    accout_user_Model arrAcoutUser;    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        setContentView(R.layout.activity_sua_thong_tin_nguoi_dung);        anhXa();        getSharepr();        setValue();        batSuKien();    }    private void setValue() {        SuaThongTinNguoiDung_edt_tenNguoiDung.setText(nameShr);        SuaThongTinNguoiDung_edt_tenDangNhap.setText(userNameShr);        SuaThongTinNguoiDung_edt_gmail.setText(gmailShr);        SuaThongTinNguoiDung_edt_soDienThoaiNguoiDung.setText("0" + soDienThoaiShr);        SuaThongTinNguoiDung_edt_diaChi.setText(diaChiShr);        SuaThongTinNguoiDung_edt_matKhau.setText(matKhauShr);    }    private void batSuKien() {        SuaThongTinNguoiDung_img_btn_back.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                Intent intent = new Intent(suaThongTinNguoiDung_Activity.this, thongTinUser_Activity.class);                startActivity(intent);            }        });        SuaThongTinNguoiDung_llout_suaThongTin.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                checkValidateSet();            }        });//        ThongTinUser_llout_quanLyNhanVien.setOnClickListener(new View.OnClickListener() {//            @Override//            public void onClick(View view) {//                Intent intent = new Intent(suaThongTinNguoiDung_Activity.this, quanLyThanhVien_Activity.class);//                startActivity(intent);//            }//        });    }    /********************lấy dữ liệu từ firebase gán vào arrList**********************/    private void firebaseData() {        //         Gán giá trị trong firebase        database = FirebaseDatabase.getInstance("https://asmandroid-duan1-default-rtdb.asia-southeast1.firebasedatabase.app/");        databaseRef = database.getReference().child("Users");        databaseRef.addValueEventListener(new ValueEventListener() {            @Override            public void onDataChange(@NonNull DataSnapshot snapshot) {                arrayListAcoutUsser.clear();                for (DataSnapshot child : snapshot.getChildren()) {                    // gọi dữ liệu trên firebase về                    arrAcoutUser = child.getValue(accout_user_Model.class);                    // add vào listItemSanpham                    if (arrAcoutUser.getIdUser() != null) {                        arrayListAcoutUsser.add(new accout_user_Model(                                arrAcoutUser.getIdUser(),                                arrAcoutUser.getQuyen(),                                arrAcoutUser.getName(),                                arrAcoutUser.getUserName(),                                arrAcoutUser.getPassword(),                                arrAcoutUser.getDiaChi(),                                arrAcoutUser.getGmail(),                                arrAcoutUser.getSoDienThoai(),                                arrAcoutUser.getNgayTao(),                                arrAcoutUser.getTrangThai(),                                arrAcoutUser.getIdGioHang(),                                arrAcoutUser.getAvatar()));                    }                }                checkTaiKhoanTrungLap();            }            @Override            public void onCancelled(DatabaseError error) {            }        });    }    //kiểm tra khoảng trắng    public static boolean containsWhiteSpace(String line) {        boolean space = false;        if (line != null) {            for (int i = 0; i < line.length(); i++) {                if (line.charAt(i) == ' ') {                    space = true;                }            }        }        return space;    }    private void setNullBackgourd(EditText edt) {        edt.setBackgroundResource(R.drawable.broder_stroke_black);    }    private void error(EditText edt, String tv) {        edt.setError(tv);        edt.setBackgroundResource(R.drawable.broder_stroke_red_error);        edt.requestFocus();    }    private boolean checkTaiKhoanTrungLap() {        boolean check = false;        for (int i = 0; i < arrayListAcoutUsser.size(); i = i + 1) {            String userNameFirebase = arrayListAcoutUsser.get(i).getUserName();            if (userName.equals(userNameFirebase)) {                check = true;            }            if (userName.equals(userNameShr)) {                check = false;            }        }        return check;    }    private void suaTaiKhoan() {    }    private void checkValidateSet() {        firebaseData();        name = SuaThongTinNguoiDung_edt_tenNguoiDung.getText().toString().trim();        userName = SuaThongTinNguoiDung_edt_tenDangNhap.getText().toString().trim();        gmail = SuaThongTinNguoiDung_edt_gmail.getText().toString().trim();        address = SuaThongTinNguoiDung_edt_diaChi.getText().toString().trim();        numberPhone = SuaThongTinNguoiDung_edt_soDienThoaiNguoiDung.getText().toString().trim();        password = SuaThongTinNguoiDung_edt_matKhau.getText().toString().trim();        repeatPassword = SuaThongTinNguoiDung_edt_xacNhanMatKhau.getText().toString();        if (!name.equals("")) {            setNullBackgourd(SuaThongTinNguoiDung_edt_tenNguoiDung);            if (!userName.equals("")) {                setNullBackgourd(SuaThongTinNguoiDung_edt_tenDangNhap);                if (!(userName.length() <= 5)) {                    setNullBackgourd(SuaThongTinNguoiDung_edt_tenDangNhap);                    if (!containsWhiteSpace(userName)) {                        setNullBackgourd(SuaThongTinNguoiDung_edt_tenDangNhap);                        if (!checkTaiKhoanTrungLap()) {                            setNullBackgourd(SuaThongTinNguoiDung_edt_tenDangNhap);                            if (!address.equals("")) {                                setNullBackgourd(SuaThongTinNguoiDung_edt_diaChi);                                if (!numberPhone.equals("")) {                                    setNullBackgourd(SuaThongTinNguoiDung_edt_soDienThoaiNguoiDung);                                    if (numberPhone.matches(reg)) {                                        setNullBackgourd(SuaThongTinNguoiDung_edt_soDienThoaiNguoiDung);                                        if (!password.equals("")) {                                            setNullBackgourd(SuaThongTinNguoiDung_edt_matKhau);                                            if (!containsWhiteSpace(password)) {                                                setNullBackgourd(SuaThongTinNguoiDung_edt_matKhau);                                                if (!repeatPassword.equals("")) {                                                    setNullBackgourd(SuaThongTinNguoiDung_edt_xacNhanMatKhau);                                                    if (!containsWhiteSpace(repeatPassword)) {                                                        setNullBackgourd(SuaThongTinNguoiDung_edt_xacNhanMatKhau);                                                        if (repeatPassword.equals(matKhauShr)) {                                                            setNullBackgourd(SuaThongTinNguoiDung_edt_xacNhanMatKhau);                                                            //       Mở thông báo                                                            //   kiểm tra                                                            //       thêm dữ liệu vào firebase                                                            //         Gán giá trị trong firebase                                                            database = FirebaseDatabase.getInstance("https://asmandroid-duan1-default-rtdb.asia-southeast1.firebasedatabase.app/");                                                            databaseRef = database.getReference().child("Users");                                                            databaseRef.child(idUser).child("name").setValue(name);                                                            databaseRef.child(idUser).child("userName").setValue(userName);                                                            databaseRef.child(idUser).child("password").setValue(password);                                                            databaseRef.child(idUser).child("diaChi").setValue(address);                                                            databaseRef.child(idUser).child("gmail").setValue(gmail);                                                            databaseRef.child(idUser).child("soDienThoai").setValue(Integer.parseInt(numberPhone));                                                            shareAcout = getSharedPreferences("AccountSharedPreferences", MODE_PRIVATE);                                                            SharedPreferences.Editor editor = shareAcout.edit();                                                            editor.putString("key_name", name);                                                            editor.putString("key_userName", userName);                                                            editor.putString("key_password", password);                                                            editor.putString("key_diaChi", address);                                                            editor.putInt("key_soDienThoai", Integer.parseInt(numberPhone));                                                            editor.putString("key_gmail", gmail);                                                            editor.apply();                                                        } else {                                                            error(SuaThongTinNguoiDung_edt_xacNhanMatKhau, "Xác nhận mật khẩu không trùng khớp vớt mật khẩu cũ!");                                                        }                                                    } else {                                                        error(SuaThongTinNguoiDung_edt_xacNhanMatKhau, "Xác nhận mật khẩu không được có khoảng trắng!");                                                    }                                                } else {                                                    error(SuaThongTinNguoiDung_edt_xacNhanMatKhau, "Xác nhận mật khẩu không được bỏ trống!");                                                }                                            } else {                                                error(SuaThongTinNguoiDung_edt_matKhau, "Mật khẩu không được có khoảng trắng!");                                            }                                        } else {                                            error(SuaThongTinNguoiDung_edt_matKhau, "Mật khẩu không được bỏ trống!");                                        }                                    } else {                                        error(SuaThongTinNguoiDung_edt_soDienThoaiNguoiDung, "Số điện thoại không không hợp lệ!");                                    }                                } else {                                    error(SuaThongTinNguoiDung_edt_soDienThoaiNguoiDung, "Số điện thoại không được để trống!");                                }                            } else {                                error(SuaThongTinNguoiDung_edt_diaChi, "Địa chỉ không được bỏ trống!");                            }                        } else {                            error(SuaThongTinNguoiDung_edt_tenDangNhap, "Tài này đã tồn tại!");                        }                    } else {                        error(SuaThongTinNguoiDung_edt_tenDangNhap, "Tên đăng nhập không được có khoảng trắng ' ' !");                    }                } else {                    error(SuaThongTinNguoiDung_edt_tenDangNhap, "Tên đăng nhập không được nhỏ hơn 5 kí tự!");                }            } else {                error(SuaThongTinNguoiDung_edt_tenDangNhap, "Tên đăng nhập không được để trống!");            }        } else {            error(SuaThongTinNguoiDung_edt_tenNguoiDung, "Tên người dùng không được để trống!");        }    }    /********************lấy dữ liệu từ Sharedpre...**********************/    private void getSharepr() {        shareAcout = getSharedPreferences("AccountSharedPreferences", MODE_PRIVATE);        idUser = shareAcout.getString("key_idUserName", "");        quyenShr = shareAcout.getInt("key_quyen", 0);        idgioHangShr = idgioHangShr = shareAcout.getString("key_idGioHang", "");        avatarShr = shareAcout.getString("key_avatar", "");        nameShr = shareAcout.getString("key_name", "");        userNameShr = shareAcout.getString("key_userName", "");        passwordShr = shareAcout.getString("key_password", "");        diaChiShr = shareAcout.getString("key_diaChi", "");        soDienThoaiShr = shareAcout.getInt("key_soDienThoai", 0);        gmailShr = shareAcout.getString("key_gmail", "");        matKhauShr = shareAcout.getString("key_password", "");    }    private void anhXa() {        arrayListAcoutUsser = new ArrayList<>();        ThongTinUser_llout_quanLyNhanVien= findViewById(R.id.thongTinUser_llout_quanLyNhanVien);        database = FirebaseDatabase.getInstance("https://asmandroid-duan1-default-rtdb.asia-southeast1.firebasedatabase.app/");//        ImageView        SuaThongTinNguoiDung_img_btn_back = findViewById(R.id.suaThongTinNguoiDung_img_btn_back);//        EditText        SuaThongTinNguoiDung_edt_tenNguoiDung = findViewById(R.id.suaThongTinNguoiDung_edt_tenNguoiDung);        SuaThongTinNguoiDung_edt_tenDangNhap = findViewById(R.id.suaThongTinNguoiDung_edt_tenDangNhap);        SuaThongTinNguoiDung_edt_gmail = findViewById(R.id.suaThongTinNguoiDung_edt_gmail);        SuaThongTinNguoiDung_edt_soDienThoaiNguoiDung = findViewById(R.id.suaThongTinNguoiDung_edt_soDienThoaiNguoiDung);        SuaThongTinNguoiDung_edt_diaChi = findViewById(R.id.suaThongTinNguoiDung_edt_diaChi);        SuaThongTinNguoiDung_edt_matKhau = findViewById(R.id.suaThongTinNguoiDung_edt_matKhau);        SuaThongTinNguoiDung_edt_xacNhanMatKhau = findViewById(R.id.suaThongTinNguoiDung_edt_xacNhanMatKhau);//        LinearLayout        SuaThongTinNguoiDung_llout_suaThongTin = findViewById(R.id.suaThongTinNguoiDung_llout_suaThongTin);    }}