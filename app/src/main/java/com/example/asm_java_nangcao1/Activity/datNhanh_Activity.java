package com.example.asm_java_nangcao1.Activity;import androidx.appcompat.app.AppCompatActivity;import android.annotation.SuppressLint;import android.app.Dialog;import android.content.Intent;import android.content.SharedPreferences;import android.graphics.Color;import android.graphics.drawable.ColorDrawable;import android.os.Bundle;import android.os.Handler;import android.view.Gravity;import android.view.View;import android.view.Window;import android.view.WindowManager;import android.widget.EditText;import android.widget.ImageView;import android.widget.LinearLayout;import android.widget.TextView;import android.widget.Toast;import com.bumptech.glide.Glide;import com.example.asm_java_nangcao1.R;import com.example.asm_java_nangcao1.Model.gioHang_Model;import com.google.firebase.database.DataSnapshot;import com.google.firebase.database.DatabaseError;import com.google.firebase.database.DatabaseReference;import com.google.firebase.database.FirebaseDatabase;import com.google.firebase.database.ValueEventListener;import java.util.UUID;public class datNhanh_Activity extends AppCompatActivity {    private TextView            DatNhanh_tv_number_produc,            DatNhanh_tv_nameProduc,            DatNhanh_tv_giaSanPham,            DatNhanh_tv_xuatXuSanPham,            DatNhanh_tv_loaiSanPham,            DatNhanh_tv_showTongGiaSanPham;    private ImageView            DatNhanh_imgProduc,            DatNhanh_img_btn_comeBack,            DatNhanh_img_btn_cart,            DatNhanh_img_btn_giamSanPham,            DatNhanh_img_btn_tangSanPham;    private EditText DatNhanh_edt_soLuongSanPham;    private LinearLayout DatNhanh_llout_btn_datHang;    private String stIdSanPham;    private String stTenSanPham;    private String stGiaSanPham;    private String stXuatXuSanPham;    private int inLoaiSanPham;    private String stImgSanPham;    private FirebaseDatabase database;    private DatabaseReference myRef;    private UUID uuid;    private gioHang_Model listGioHang;    private DatabaseReference databaseGiohang;    private SharedPreferences shareAcout;    private  String idgioHangShr;    @Override    protected void onResume() {        super.onResume();    }    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        setContentView(R.layout.activity_dat_nhanh);        anhXa();        getSharepr();        setValue();        setSoLuong();        batSuKien();        firebasGetNumberCart(DatNhanh_tv_number_produc);    }    /********************lấy dữ liệu từ Sharedpre...**********************/    private void getSharepr() {        shareAcout = getSharedPreferences("AccountSharedPreferences", MODE_PRIVATE);        shareAcout.getString("key_idUserName", "");        shareAcout.getInt("key_quyen", 0);        idgioHangShr = shareAcout.getString("key_idGioHang", "");        shareAcout.getString("key_avatar", "");        shareAcout.getString("key_name", "");        shareAcout.getString("key_userName", "");        shareAcout.getString("key_password", "");        shareAcout.getString("key_diaChi", "");        shareAcout.getInt("key_soDienThoai", 0);        shareAcout.getString("key_gmail", "");    }    /********************lấy dữ liệu từ firebase kiểm tra số lượng trong giỏ hảng**********************/    public void firebasGetNumberCart(TextView tvNumberProduc) {        anhXa();        databaseGiohang = FirebaseDatabase.getInstance("https://asmandroid-duan1-default-rtdb.asia-southeast1.firebasedatabase.app/").getReference("Cart").child(idgioHangShr);        databaseGiohang.addValueEventListener(new ValueEventListener() {            @Override            public void onDataChange(DataSnapshot snapshot) {                int i = 0;                for (DataSnapshot child : snapshot.getChildren()) {                    i = i + 1;                }                tvNumberProduc.setText(i + "");                //        show thông tin theo kiểu dọc            }            @Override            public void onCancelled(DatabaseError error) {            }        });    }    private void batSuKien() {        anhXa();//        thoát trang chi tiết sản phẩm        DatNhanh_img_btn_comeBack.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                Intent intent = new Intent(datNhanh_Activity.this, sanPham_Activity.class);                Bundle bundle = new Bundle();                bundle.putBoolean("key_checkLoading", false);                intent.putExtras(bundle);                startActivity(intent);            }        });//        đặt hàng        DatNhanh_llout_btn_datHang.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                setDatHang();            }        });//        chuyển trang giỏ hàng        DatNhanh_img_btn_cart.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                Intent intent = new Intent(datNhanh_Activity.this,gioHang_Activity.class);                startActivity(intent);            }        });    }    /********************showDialog**********************/    public void openDialogAddToCart() {        final Dialog dialog = new Dialog(this);        dialog.requestWindowFeature(Window.FEATURE_NO_TITLE);        dialog.setContentView(R.layout.dialog_addtocart);        Window window = dialog.getWindow();        if (window == null) {            return;        }        window.setLayout(WindowManager.LayoutParams.MATCH_PARENT, WindowManager.LayoutParams.WRAP_CONTENT);        window.setBackgroundDrawable(new ColorDrawable(Color.TRANSPARENT));        WindowManager.LayoutParams windowAttributes = window.getAttributes();        windowAttributes.gravity = Gravity.CENTER;        window.setAttributes(windowAttributes);//        sử lý khi nhấn ra ngoài thì có thoát hay không        dialog.setCancelable(false);//        khai báo bắt sự kiện        dialog.show();        final Handler handler = new Handler();        handler.postDelayed(new Runnable() {            @Override            public void run() {                dialog.dismiss();            }        }, 2200);    }    private void setDatHang() {        anhXa();        nhanDuLieuIntent();        openDialogAddToCart();        int soLuongSanPham = Integer.parseInt(DatNhanh_edt_soLuongSanPham.getText().toString());//       địa chỉ đường giẫn lưu thông tin//        đường giẫn tại "Users", tại child        //        firebase        database = FirebaseDatabase.getInstance("https://asmandroid-duan1-default-rtdb.asia-southeast1.firebasedatabase.app/");        myRef = database.getReference("Cart").child(idgioHangShr);//        add vô mảng rồi lưu thông tin lên địa chỉ        listGioHang = new gioHang_Model(uuid.toString(), stIdSanPham, soLuongSanPham);        myRef.child(listGioHang.getIdGioHang()).setValue(listGioHang);        DatNhanh_edt_soLuongSanPham.setText("1");    }    @SuppressLint("ResourceAsColor")    public void showError(EditText filed, String text) {        filed.setError(text);        filed.requestFocus();        filed.setBackgroundResource(R.drawable.broder_stroke_red_error);    }    // thêm số lượng tăng set giá tiền    private void setSoLuong() {        anhXa();        nhanDuLieuIntent();        DatNhanh_tv_showTongGiaSanPham.setText(stGiaSanPham + "vnđ");//        kiểm tra khi tăng số lượng        DatNhanh_img_btn_tangSanPham.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                int soluong = Integer.parseInt(DatNhanh_edt_soLuongSanPham.getText().toString());                if (!((soluong + 1) > 20)) {                    soluong = soluong + 1;                    DatNhanh_edt_soLuongSanPham.setText(soluong + "");                    DatNhanh_edt_soLuongSanPham.setError(null);                    DatNhanh_edt_soLuongSanPham.setBackgroundResource(R.drawable.broder_stroke_black);                    setTongGiaTienSanPham(soluong);                } else {                    showError(DatNhanh_edt_soLuongSanPham, "Số lượng sản phẩm < 20");                }            }        });//        kiểm tra khi giảm số lượng        DatNhanh_img_btn_giamSanPham.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                int soluong = Integer.parseInt(DatNhanh_edt_soLuongSanPham.getText().toString());                if (!((soluong - 1) < 1)) {                    soluong = soluong - 1;                    DatNhanh_edt_soLuongSanPham.setText(soluong + "");                    DatNhanh_edt_soLuongSanPham.setError(null);                    DatNhanh_edt_soLuongSanPham.setBackgroundResource(R.drawable.broder_stroke_black);                    setTongGiaTienSanPham(soluong);                } else {                    showError(DatNhanh_edt_soLuongSanPham, "Số lượng sản phẩm > 0");                }            }        });    }    private void setTongGiaTienSanPham(int soluong) {        nhanDuLieuIntent();        Double giaSanPham = Double.parseDouble(stGiaSanPham);        giaSanPham = giaSanPham * soluong;        String stGia = String.format(giaSanPham.toString());        if (stGia.length() > 6) {            DatNhanh_tv_showTongGiaSanPham.setText(stGia.substring(0, 6) + "00vnđ");        } else {            DatNhanh_tv_showTongGiaSanPham.setText(giaSanPham + "00vnđ");        }    }    private void setValue() {        anhXa();        nhanDuLieuIntent();        //gán hình ảnh bằng link        Glide.with(datNhanh_Activity.this)                .load(stImgSanPham)                .into(DatNhanh_imgProduc);        DatNhanh_tv_nameProduc.setText(stTenSanPham);        DatNhanh_tv_giaSanPham.setText(stGiaSanPham + "vnđ");        DatNhanh_tv_xuatXuSanPham.setText("Xuất xứ: " + stXuatXuSanPham);        String loaiSp;        if (inLoaiSanPham == 1) {            loaiSp = "Cây cảnh trong nhà";        } else if (inLoaiSanPham == 2) {            loaiSp = "Cây vườn";        } else {            loaiSp = "Cây cao cấp";        }        DatNhanh_tv_loaiSanPham.setText("Loại Sp: " + loaiSp);        DatNhanh_edt_soLuongSanPham.setText("1");    }    private void nhanDuLieuIntent() {        Intent intent = getIntent();        Bundle bundle = intent.getExtras();        if (bundle != null) {            stIdSanPham = bundle.getString("key_idSanPham", "");            stTenSanPham = bundle.getString("key_tenSanPham", "");            stGiaSanPham = bundle.getString("key_giaSanPham", "");            stXuatXuSanPham = bundle.getString("key_xuatXuSanPham", "");            inLoaiSanPham = bundle.getInt("key_loaiSanPham", 0);            stImgSanPham = bundle.getString("key_imgSanPham", "");        }    }    private void anhXa() {//        SharedPreferences        shareAcout = getSharedPreferences("AccountSharedPreferences", MODE_PRIVATE);//        ramdom        uuid = UUID.randomUUID();//        firebase        database = FirebaseDatabase.getInstance("https://asmandroid-duan1-default-rtdb.asia-southeast1.firebasedatabase.app/");//        TextView        DatNhanh_tv_number_produc = findViewById(R.id.datNhanh_tv_number_produc);        DatNhanh_tv_nameProduc = findViewById(R.id.datNhanh_tv_nameProduc);        DatNhanh_tv_giaSanPham = findViewById(R.id.datNhanh_tv_giaSanPham);        DatNhanh_tv_xuatXuSanPham = findViewById(R.id.datNhanh_tv_xuatXuSanPham);        DatNhanh_tv_loaiSanPham = findViewById(R.id.datNhanh_tv_loaiSanPham);        DatNhanh_tv_showTongGiaSanPham = findViewById(R.id.datNhanh_tv_showTongGiaSanPham);//        EditText        DatNhanh_edt_soLuongSanPham = findViewById(R.id.datNhanh_edt_soLuongSanPham);//        ImgView        DatNhanh_imgProduc = findViewById(R.id.datNhanh_imgProduc);        DatNhanh_img_btn_comeBack = findViewById(R.id.datNhanh_img_btn_comeBack);        DatNhanh_img_btn_cart = findViewById(R.id.datNhanh_img_btn_cart);        DatNhanh_img_btn_giamSanPham = findViewById(R.id.datNhanh_img_btn_giamSanPham);        DatNhanh_img_btn_tangSanPham = findViewById(R.id.datNhanh_img_btn_tangSanPham);//        LineaLayout        DatNhanh_llout_btn_datHang = findViewById(R.id.datNhanh_llout_btn_datHang);    }}