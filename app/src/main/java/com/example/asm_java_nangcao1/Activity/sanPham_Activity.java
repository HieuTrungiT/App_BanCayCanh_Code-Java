package com.example.asm_java_nangcao1.Activity;import androidx.annotation.NonNull;import androidx.appcompat.app.AppCompatActivity;import androidx.constraintlayout.widget.ConstraintLayout;import androidx.recyclerview.widget.DefaultItemAnimator;import androidx.recyclerview.widget.GridLayoutManager;import androidx.recyclerview.widget.LinearLayoutManager;import androidx.recyclerview.widget.RecyclerView;import android.app.Dialog;import android.content.Intent;import android.content.SharedPreferences;import android.graphics.Color;import android.graphics.drawable.ColorDrawable;import android.os.Bundle;import android.os.Handler;import android.view.Gravity;import android.view.KeyEvent;import android.view.View;import android.view.Window;import android.view.WindowManager;import android.view.animation.Animation;import android.view.animation.AnimationUtils;import android.widget.EditText;import android.widget.ImageView;import android.widget.TextView;import android.widget.Toast;import com.airbnb.lottie.LottieAnimationView;import com.example.asm_java_nangcao1.Adapter.horizontal_listProduc_Adapter;import com.example.asm_java_nangcao1.Adapter.vertical_listProduc_Adapter;import com.example.asm_java_nangcao1.Model.accout_user_Model;import com.example.asm_java_nangcao1.Model.gioHang_Model;import com.example.asm_java_nangcao1.R;import com.google.firebase.database.DataSnapshot;import com.google.firebase.database.DatabaseError;import com.google.firebase.database.DatabaseReference;import com.google.firebase.database.FirebaseDatabase;import com.google.firebase.database.ValueEventListener;import com.example.asm_java_nangcao1.Model.khoHang_Model;import java.util.ArrayList;import de.hdodenhof.circleimageview.CircleImageView;public class sanPham_Activity extends AppCompatActivity {    private RecyclerView            SanPham_rsclView_produc_horizontal,            SanPham_rsclView_produc_vertical;    private ImageView            SanPham_img_btn_cart,            SanPham_img_btn_search;    private TextView            SanPham_tv_numberProduc,            SanPham_tv_textAnim;    private EditText            SanPham_edt_search;    private CircleImageView            SanPham_img_avatarUser;    private LottieAnimationView            SanPham_loadingAnim_lotte;    Animation            SanPham_anim_txtContext;    private ConstraintLayout            SanPham_costLout_loanding;    //Model    ArrayList<khoHang_Model> mainModels;    ArrayList<gioHang_Model> arrayListGioHang;    khoHang_Model arrProduc;    // adapter    horizontal_listProduc_Adapter horizontalListProduc_Adapter;    vertical_listProduc_Adapter vertical_listProduc_Adapter;    //   FireBase    DatabaseReference database;    DatabaseReference databaseGiohang;    //    SharedPreferences    private SharedPreferences shareAcout;    private String idgioHangShr;    //   check    boolean checkActivity = true;    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        setContentView(R.layout.activity_san_pham);//        ánh xạ id activity        anhXa();        getSharepr();        nhanDuLieuIntent();        firebasGetNumberCart(SanPham_tv_numberProduc);        //        gọi dữ liệu firebase add vào arrList        firebaseData();        if (checkActivity == true) {            anim();        } else {            SanPham_costLout_loanding.setVisibility(View.INVISIBLE);        }        //        lấy số lượng set lên giỏ hàng        //        show thông tin theo kiểu ngang        showListProduc_Horizoltal();        //        show thông tin theo kiểu dọc        showListProduc_Vartical();        //        Bắt sự kiện        batSuKien();    }    /********************lấy dữ liệu từ Sharedpre...**********************/    private void getSharepr() {        shareAcout = getSharedPreferences("AccountSharedPreferences", MODE_PRIVATE);        shareAcout.getString("key_idUserName", "");        shareAcout.getInt("key_quyen", 0);        idgioHangShr = shareAcout.getString("key_idGioHang", "");        shareAcout.getString("key_avatar", "");        shareAcout.getString("key_name", "");        shareAcout.getString("key_userName", "");        shareAcout.getString("key_password", "");        shareAcout.getString("key_diaChi", "");        shareAcout.getInt("key_soDienThoai", 0);        shareAcout.getString("key_gmail", "");    }    private void nhanDuLieuIntent() {        Intent intent = getIntent();        Bundle bundle = intent.getExtras();        if (bundle != null) {            checkActivity = bundle.getBoolean("key_checkLoading", true);        }    }    /********************Anim Loanding**********************/    private void anim() {        anhXa();        SanPham_tv_textAnim.setAnimation(SanPham_anim_txtContext);        SanPham_anim_txtContext.setAnimationListener(new Animation.AnimationListener() {            @Override            public void onAnimationStart(Animation animation) {            }            @Override            public void onAnimationEnd(Animation animation) {                SanPham_loadingAnim_lotte.setVisibility(View.VISIBLE);                final Handler handler = new Handler();                handler.postDelayed(new Runnable() {                    @Override                    public void run() {                        SanPham_costLout_loanding.setVisibility(View.INVISIBLE);                    }                }, 1000);            }            @Override            public void onAnimationRepeat(Animation animation) {            }        });    }    /********************bắt sự kiện khi bấm vào item chuyển trang chi tiếtc**********************/    public void showChiTietSanPham(int position) {        Intent intent = new Intent(sanPham_Activity.this, datNhanh_Activity.class);        Bundle bundle = new Bundle();        bundle.putString("key_idSanPham", mainModels.get(position).getIdSanPham());        bundle.putString("key_tenSanPham", mainModels.get(position).getTenSanPham());        bundle.putString("key_giaSanPham", mainModels.get(position).getGiaSanPham());        bundle.putString("key_xuatXuSanPham", mainModels.get(position).getXuatXu());        bundle.putInt("key_loaiSanPham", mainModels.get(position).getLoaiSanPham());        bundle.putString("key_imgSanPham", mainModels.get(position).getHinhAnh());        intent.putExtras(bundle);        startActivity(intent);    }    /********************bắt sự kiện khi bấm vào thao tác**********************/    private void batSuKien() {//        chuyển trang thông tin user        SanPham_img_avatarUser.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                Intent intent = new Intent(sanPham_Activity.this, thongTinUser_Activity.class);                startActivity(intent);            }        });//        chuyển trang giỏ hàng        SanPham_img_btn_cart.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                Intent intent = new Intent(sanPham_Activity.this, gioHang_Activity.class);                startActivity(intent);            }        });        SanPham_img_btn_search.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                timKiem();            }        });        SanPham_edt_search.setOnKeyListener(new View.OnKeyListener() {            @Override            public boolean onKey(View view, int i, KeyEvent keyEvent) {                String giaTriTimKiem = SanPham_edt_search.getText().toString();                if (!giaTriTimKiem.equals("")) {                    showListProduc_Vartical();                }                return false;            }        });    }    private void timKiem() {        String giaTriTimKiem = SanPham_edt_search.getText().toString();        ArrayList<khoHang_Model> arrListTimKiem = new ArrayList<>();        if (!giaTriTimKiem.equals("")) {            for (int i = 0; i < mainModels.size(); i = i + 1) {                if ((mainModels.get(i).getTenSanPham()).toUpperCase().contains(giaTriTimKiem.toUpperCase())) {                    arrListTimKiem.add(new khoHang_Model(mainModels.get(i).getIdSanPham(), mainModels.get(i).getTenSanPham(), mainModels.get(i).getGiaSanPham(), mainModels.get(i).getLoaiSanPham(), mainModels.get(i).getXuatXu(), mainModels.get(i).getNgayNhap(), mainModels.get(i).getHinhAnh()));                } }            SanPham_rsclView_produc_vertical.setLayoutManager(new GridLayoutManager(this, 2));            SanPham_rsclView_produc_vertical.setItemAnimator(new DefaultItemAnimator());//        Initilize            vertical_listProduc_Adapter = new vertical_listProduc_Adapter(arrListTimKiem, sanPham_Activity.this);            SanPham_rsclView_produc_vertical.setAdapter(vertical_listProduc_Adapter);        } else {          showListProduc_Vartical();        }    }    /********************Show thông tin ra kiểu ngang**********************/    private void showListProduc_Horizoltal() {        LinearLayoutManager linearLayoutManager = new LinearLayoutManager(sanPham_Activity.this, LinearLayoutManager.HORIZONTAL, false);        SanPham_rsclView_produc_horizontal.setLayoutManager(linearLayoutManager);        SanPham_rsclView_produc_horizontal.setItemAnimator(new DefaultItemAnimator());//        Initilize        horizontalListProduc_Adapter = new horizontal_listProduc_Adapter(mainModels, sanPham_Activity.this);        SanPham_rsclView_produc_horizontal.setAdapter(horizontalListProduc_Adapter);    }    /********************Show thông tin ra kiểu dọc**********************/    private void showListProduc_Vartical() {        SanPham_rsclView_produc_vertical.setLayoutManager(new GridLayoutManager(this, 2));        SanPham_rsclView_produc_vertical.setItemAnimator(new DefaultItemAnimator());//        Initilize        vertical_listProduc_Adapter = new vertical_listProduc_Adapter(mainModels, sanPham_Activity.this);        SanPham_rsclView_produc_vertical.setAdapter(vertical_listProduc_Adapter);    }    /********************lấy dữ liệu từ firebase kiểm tra số lượng trong giỏ hảng**********************/    public void firebasGetNumberCart(TextView tvNumberProduc) {        anhXa();        databaseGiohang = FirebaseDatabase.getInstance("https://asmandroid-duan1-default-rtdb.asia-southeast1.firebasedatabase.app/").getReference("Cart").child(idgioHangShr);        ;        databaseGiohang.addValueEventListener(new ValueEventListener() {            @Override            public void onDataChange(DataSnapshot snapshot) {                arrayListGioHang.clear();                int i = 0;                for (DataSnapshot child : snapshot.getChildren()) {                    i = i + 1;                }                tvNumberProduc.setText(i + "");                //        show thông tin theo kiểu dọc                firebaseData();            }            @Override            public void onCancelled(DatabaseError error) {            }        });    }    /********************lấy dữ liệu từ firebase gán vào arrList**********************/    private void firebaseData() {        //         Gán giá trị trong firebase        database = FirebaseDatabase.getInstance("https://asmandroid-duan1-default-rtdb.asia-southeast1.firebasedatabase.app/").getReference().child("khoHang");        database.addValueEventListener(new ValueEventListener() {            @Override            public void onDataChange(@NonNull DataSnapshot snapshot) {                mainModels.clear();                for (DataSnapshot child : snapshot.getChildren()) {                    // gọi dữ liệu trên firebase về                    arrProduc = child.getValue(khoHang_Model.class);                    // add vào listItemSanpham                    if (arrProduc.getIdSanPham() != null) {                        mainModels.add(new khoHang_Model(arrProduc.getIdSanPham(), arrProduc.getTenSanPham(), arrProduc.getGiaSanPham(), arrProduc.getLoaiSanPham(), arrProduc.getXuatXu(), arrProduc.getNgayNhap(), arrProduc.getHinhAnh()));                    }                }                //    gán vào adapter                horizontalListProduc_Adapter.notifyDataSetChanged();                vertical_listProduc_Adapter.notifyDataSetChanged();            }            @Override            public void onCancelled(DatabaseError error) {            }        });    }    /********************showDialog**********************/    public void openDialogAddToCart() {        final Dialog dialog = new Dialog(this);        dialog.requestWindowFeature(Window.FEATURE_NO_TITLE);        dialog.setContentView(R.layout.dialog_addtocart);        Window window = dialog.getWindow();        if (window == null) {            return;        }        window.setLayout(WindowManager.LayoutParams.MATCH_PARENT, WindowManager.LayoutParams.WRAP_CONTENT);        window.setBackgroundDrawable(new ColorDrawable(Color.TRANSPARENT));        WindowManager.LayoutParams windowAttributes = window.getAttributes();        windowAttributes.gravity = Gravity.CENTER;        window.setAttributes(windowAttributes);//        sử lý khi nhấn ra ngoài thì có thoát hay không        dialog.setCancelable(false);//        khai báo bắt sự kiện        TextView Dialog_them_tvBtn_khong = dialog.findViewById(R.id.dialog_them_tvBtn_khong);        TextView Dialog_them_tvBtn_dongY = dialog.findViewById(R.id.dialog_them_tvBtn_dongY);        dialog.show();        final Handler handler = new Handler();        handler.postDelayed(new Runnable() {            @Override            public void run() {                dialog.dismiss();            }        }, 2200);    }    /********************ánh xạ dữ liệu tại activity**********************/    private void anhXa() {        //        SharedPreferences        shareAcout = getSharedPreferences("AccountSharedPreferences", MODE_PRIVATE);//        anim        SanPham_anim_txtContext = AnimationUtils.loadAnimation(this, R.anim.header_anim);//        lotte        SanPham_loadingAnim_lotte = findViewById(R.id.sanPham_anim_Loanding);//        arrList        mainModels = new ArrayList<>();        arrayListGioHang = new ArrayList<>();//        ConstraintLayout        SanPham_costLout_loanding = findViewById(R.id.sanPham_costLout_loanding);//        RecyclerView        SanPham_rsclView_produc_horizontal = findViewById(R.id.sanPham_rsclView_produc_horizontal);//        ImageView        SanPham_img_btn_cart = findViewById(R.id.sanPham_img_btn_cart);        SanPham_img_btn_search = findViewById(R.id.sanPham_img_btn_search);//        ListView        SanPham_rsclView_produc_vertical = findViewById(R.id.sanPham_rsclView_produc_vertical);//        TextView        SanPham_tv_numberProduc = findViewById(R.id.sanPham_tv_numberProduc);        SanPham_tv_textAnim = findViewById(R.id.sanPham_tv_textAnim);//        EditText        SanPham_edt_search = findViewById(R.id.sanPham_edt_search);//        CircleImageView        SanPham_img_avatarUser = findViewById(R.id.sanPham_img_avatarUser);    }}