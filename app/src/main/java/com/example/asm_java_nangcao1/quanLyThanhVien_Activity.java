package com.example.asm_java_nangcao1;import androidx.annotation.NonNull;import androidx.appcompat.app.AppCompatActivity;import android.Manifest;import android.content.Intent;import android.content.pm.PackageManager;import android.database.Cursor;import android.net.Uri;import android.os.Build;import android.os.Bundle;import android.provider.ContactsContract;import android.util.Log;import android.view.View;import android.view.animation.Animation;import android.widget.EditText;import android.widget.ImageView;import android.widget.LinearLayout;import android.widget.ListView;import android.widget.TextView;import android.widget.Toast;import com.airbnb.lottie.LottieAnimationView;import com.example.asm_java_nangcao1.Activity.thongTinUser_Activity;import com.example.asm_java_nangcao1.Adapter.vertival_listThanhVienLv_Adapter;import com.example.asm_java_nangcao1.Model.Contact;import com.example.asm_java_nangcao1.Model.accout_user_Model;import com.example.asm_java_nangcao1.Model.contact_phone_Model;import com.google.firebase.database.DataSnapshot;import com.google.firebase.database.DatabaseError;import com.google.firebase.database.DatabaseReference;import com.google.firebase.database.FirebaseDatabase;import com.google.firebase.database.ValueEventListener;import java.util.ArrayList;public class quanLyThanhVien_Activity extends AppCompatActivity {    private TextView            QuanLyThanhVien_tv_textAnim;    private EditText            QuanLyThanhVien_edt_search;    private ImageView            QuanLyThanhVien_img_btn_back;    private LinearLayout            QuanLyThanhVien_costLout_loanding;    private ListView            QuanLyThanhVien_lv_showDanhSach;    private LottieAnimationView            QuanLyThanhVien_loadingAnim_lotte;    private Animation            QuanLyThanhVien_anim_txtContext;    private FirebaseDatabase databaseAccout;    private DatabaseReference databaseRef;    private ListView lvDanhSach;    private ArrayList<Contact> dsDanhSach;    //modelaccout    private ArrayList<accout_user_Model> arrayListAcoutUsser;    private ArrayList<contact_phone_Model> arrListContactPhone;    private contact_phone_Model listContactPhone;    private accout_user_Model arrAcoutUser;    private vertival_listThanhVienLv_Adapter listItemThanhVienAdapter;    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        setContentView(R.layout.activity_quan_ly_thanh_vien2);        anhXa();        batSuKien();        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {            if (checkSelfPermission(Manifest.permission.READ_CONTACTS) != PackageManager.PERMISSION_GRANTED) {                requestPermissions(new String[]{Manifest.permission.READ_CONTACTS}, 22);            } else {                anhXa();                showAllContact();            }        }        firebaseDataAccout();        xuatDanhSach();//        Toast.makeText(this, arrayListAcoutUsser.get(1).getUserName()+"", Toast.LENGTH_SHORT).show();    }    private void xuatDanhSach() {        listItemThanhVienAdapter = new vertival_listThanhVienLv_Adapter(quanLyThanhVien_Activity.this, R.layout.item_quanlythanhvien, arrListContactPhone);        QuanLyThanhVien_lv_showDanhSach.setAdapter(listItemThanhVienAdapter);    }    private void xinCapQuyen() {        //              content provider    }    private void showAllContact() {        Uri uri = ContactsContract.CommonDataKinds.Phone.CONTENT_URI;        Cursor cursor = getContentResolver().query(uri, null, null, null, null);        while (cursor.moveToNext()) {            String tenCotName = ContactsContract.Contacts.DISPLAY_NAME;            String tenCotPhone = ContactsContract.CommonDataKinds.Phone.NUMBER;            int vtTenCotName = cursor.getColumnIndex(tenCotName);            int vtTenCotPhone = cursor.getColumnIndex(tenCotPhone);            String name = cursor.getString(vtTenCotName);            String phone = cursor.getString(vtTenCotPhone);            Toast.makeText(this, name + "", Toast.LENGTH_SHORT).show();            Contact dsContact = new Contact(name, phone);            dsDanhSach.add(dsContact);        }    }    //+84 263 3535 886    @Override    public void onRequestPermissionsResult(int requestCode, String[] permissions, int[] grantResults) {        super.onRequestPermissionsResult(requestCode, permissions, grantResults);        if (requestCode == 22) {            if (grantResults[0] == PackageManager.PERMISSION_GRANTED) {                showAllContact();            } else {                Toast.makeText(this, "camera permission denied", Toast.LENGTH_LONG).show();            }        }    }    /********************lấy dữ liệu từ firebase gán vào arrList**********************/    private void firebaseDataAccout() {        //         Gán giá trị trong firebase        databaseRef = databaseAccout.getReference().child("Users");        databaseRef.addValueEventListener(new ValueEventListener() {            @Override            public void onDataChange(@NonNull DataSnapshot snapshot) {                for (DataSnapshot child : snapshot.getChildren()) {                    // gọi dữ liệu trên firebase về                    arrAcoutUser = child.getValue(accout_user_Model.class);                    // add vào listItemSanpham                    if (arrAcoutUser.getIdUser() != null) {                        arrayListAcoutUsser.add(new accout_user_Model(                                arrAcoutUser.getIdUser(),                                arrAcoutUser.getQuyen(),                                arrAcoutUser.getName(),                                arrAcoutUser.getUserName(),                                arrAcoutUser.getPassword(),                                arrAcoutUser.getDiaChi(),                                arrAcoutUser.getGmail(),                                arrAcoutUser.getSoDienThoai(),                                arrAcoutUser.getNgayTao(),                                arrAcoutUser.getTrangThai(),                                arrAcoutUser.getIdGioHang(),                                arrAcoutUser.getAvatar()));                    }                }                if (dsDanhSach == null) {                    for (int i = 0; i < arrayListAcoutUsser.size(); i = i + 1) {                        arrListContactPhone.add(new contact_phone_Model(arrayListAcoutUsser.get(i).getIdUser(), arrayListAcoutUsser.get(i).getUserName(), arrayListAcoutUsser.get(i).getSoDienThoai() + "", arrayListAcoutUsser.get(i).getNgayTao(), arrayListAcoutUsser.get(i).getTrangThai(), arrayListAcoutUsser.get(i).getQuyen(), 0, "#FF000000"));                    }                    listItemThanhVienAdapter.notifyDataSetChanged();                } else {                    boolean check = false;String checkPhone = "";                    for (int i = 0; i < arrayListAcoutUsser.size(); i = i + 1) {//                        n                        for (int j = 0; j < dsDanhSach.size(); j = j + 1) {                            String SDTuser = String.valueOf(arrayListAcoutUsser.get(i).getSoDienThoai()).replaceAll(" ", "");                            String SDTphone = dsDanhSach.get(j).getNumberPhone().replaceAll(" ", "");                            Log.d("phone", "0" + SDTuser + ": number phone: " + SDTphone + " ");                            Log.d("phoneUser", " ");                            if (SDTphone.equals("0" + SDTuser)) {                                check = true;                                checkPhone =SDTuser;                            }                        }                        if (check == true ) {                            arrListContactPhone.add(new contact_phone_Model(arrayListAcoutUsser.get(i).getIdUser(), arrayListAcoutUsser.get(i).getUserName(), arrayListAcoutUsser.get(i).getSoDienThoai() + "", arrayListAcoutUsser.get(i).getNgayTao(), arrayListAcoutUsser.get(i).getTrangThai(), arrayListAcoutUsser.get(i).getQuyen(), 0, "#FF7E7E"));//                            arrayListAcoutUsser.remove(i);                            listItemThanhVienAdapter.notifyDataSetChanged();                            check = false;                        } else {                            arrListContactPhone.add(new contact_phone_Model(arrayListAcoutUsser.get(i).getIdUser(), arrayListAcoutUsser.get(i).getUserName(), arrayListAcoutUsser.get(i).getSoDienThoai() + "", arrayListAcoutUsser.get(i).getNgayTao(), arrayListAcoutUsser.get(i).getTrangThai(), arrayListAcoutUsser.get(i).getQuyen(), 0, "#FF000000"));//                            arrayListAcoutUsser.remove(i);                            listItemThanhVienAdapter.notifyDataSetChanged();                        }                    }                    listItemThanhVienAdapter.notifyDataSetChanged();                }            }            @Override            public void onCancelled(DatabaseError error) {            }        });    }    private void batSuKien() {        QuanLyThanhVien_img_btn_back.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                Intent intent = new Intent(quanLyThanhVien_Activity.this, thongTinUser_Activity.class);                startActivity(intent);            }        });    }    private void anhXa() {        arrayListAcoutUsser = new ArrayList<>();        arrListContactPhone = new ArrayList<>();        dsDanhSach = new ArrayList<>();        databaseAccout = FirebaseDatabase.getInstance("https://asmandroid-duan1-default-rtdb.asia-southeast1.firebasedatabase.app/");        QuanLyThanhVien_img_btn_back = findViewById(R.id.quanLyThanhVien_img_btn_back);        QuanLyThanhVien_lv_showDanhSach = findViewById(R.id.quanLyThanhVien_lv_showDanhSach);    }}